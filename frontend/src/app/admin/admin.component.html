<div class="admin-container">
  <header class="admin-header">
    <div class="header-content">
      <h1 class="title">ğŸ“Š Slurp Analytics</h1>
      <p class="subtitle">Real-time event tracking dashboard</p>
    </div>
    <div class="header-actions">
      <span class="last-updated" *ngIf="lastUpdated">
        Updated {{ lastUpdated | date:'shortTime' }}
      </span>
      <button class="refresh-btn" (click)="loadStats()" [disabled]="loading">
        <span class="refresh-icon" [class.spinning]="loading">âŸ³</span>
        Refresh
      </button>
    </div>
  </header>

  <div class="loading-state" *ngIf="loading && !stats">
    <div class="loader"></div>
    <p>Loading analytics...</p>
  </div>

  <div class="error-state" *ngIf="error && !stats">
    <span class="error-icon">âš ï¸</span>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="loadStats()">Try Again</button>
  </div>

  <div class="dashboard" *ngIf="stats">
    <!-- Key Metrics -->
    <section class="metrics-grid">
      <div class="metric-card total">
        <div class="metric-icon">ğŸ“ˆ</div>
        <div class="metric-content">
          <span class="metric-value">{{ stats.total_events | number }}</span>
          <span class="metric-label">Total Events</span>
        </div>
      </div>
      
      <div class="metric-card recent">
        <div class="metric-icon">âš¡</div>
        <div class="metric-content">
          <span class="metric-value">{{ stats.events_last_24h | number }}</span>
          <span class="metric-label">Last 24 Hours</span>
        </div>
      </div>
      
      <div class="metric-card weekly">
        <div class="metric-icon">ğŸ“…</div>
        <div class="metric-content">
          <span class="metric-value">{{ stats.events_last_7d | number }}</span>
          <span class="metric-label">Last 7 Days</span>
        </div>
      </div>
      
      <div class="metric-card unique">
        <div class="metric-icon">ğŸŒ</div>
        <div class="metric-content">
          <span class="metric-value">{{ stats.unique_ips | number }}</span>
          <span class="metric-label">Unique Visitors</span>
        </div>
      </div>
    </section>

    <!-- Charts Row -->
    <section class="charts-row">
      <!-- Events by Type -->
      <div class="chart-card types-chart">
        <h2 class="chart-title">Events by Type</h2>
        <div class="type-bars">
          <div 
            class="type-bar-item" 
            *ngFor="let item of stats.events_by_type"
          >
            <div class="type-info">
              <span class="type-emoji">{{ getEventTypeEmoji(item.type) }}</span>
              <span class="type-name">{{ item.type }}</span>
              <span class="type-count">{{ item.count | number }}</span>
            </div>
            <div class="type-bar-container">
              <div 
                class="type-bar" 
                [style.width.%]="getTypePercentage(item.count)"
                [style.background-color]="getEventTypeColor(item.type)"
              ></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Events Timeline -->
      <div class="chart-card timeline-chart">
        <h2 class="chart-title">30-Day Timeline</h2>
        <div class="timeline-container">
          <div class="timeline-bars">
            <div 
              class="timeline-bar-wrapper"
              *ngFor="let day of stats.events_by_day"
              [title]="formatDate(day.date) + ': ' + day.count + ' events'"
            >
              <div 
                class="timeline-bar" 
                [style.height.%]="getBarHeight(day.count)"
              ></div>
              <span class="timeline-label">{{ formatDate(day.date) }}</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Recent Events -->
    <section class="recent-events-section">
      <h2 class="section-title">Recent Events</h2>
      <div class="events-table-container">
        <table class="events-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Type</th>
              <th>Data</th>
              <th>IP</th>
              <th>User Agent</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let event of stats.recent_events" class="event-row">
              <td class="time-cell">{{ formatDateTime(event.created_at) }}</td>
              <td class="type-cell">
                <span 
                  class="type-badge"
                  [style.background-color]="getEventTypeColor(event.event_type)"
                >
                  {{ getEventTypeEmoji(event.event_type) }} {{ event.event_type }}
                </span>
              </td>
              <td class="data-cell">
                <span class="data-value" *ngIf="event.event_data">{{ event.event_data }}</span>
                <span class="no-data" *ngIf="!event.event_data">â€”</span>
              </td>
              <td class="ip-cell">
                <code class="ip-address">{{ event.ip_address || 'â€”' }}</code>
              </td>
              <td class="ua-cell">
                <span class="ua-text" [title]="event.user_agent || ''">
                  {{ event.user_agent || 'â€”' }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>
</div>
